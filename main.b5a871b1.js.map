{"version":3,"sources":["src/assets/samples/tr808/index.ts","src/main.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAoBa,aAAA,IAAA,EAAA,MAAA,KAAA,iBAAA,SAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,IAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IApBb,IAAA,EAAA,EAAA,QAAA,mBACA,EAAA,EAAA,QAAA,oBACA,EAAA,EAAA,QAAA,oBACA,EAAA,EAAA,QAAA,kBACA,EAAA,EAAA,QAAA,iBACA,EAAA,EAAA,QAAA,oBACA,EAAA,EAAA,QAAA,mBACA,EAAA,EAAA,QAAA,eACA,EAAA,EAAA,QAAA,gBACA,EAAA,EAAA,QAAA,eAEa,QAAA,QAAkB,EAAA,QAClB,QAAA,SAAmB,EAAA,QACnB,QAAA,SAAmB,EAAA,QACnB,QAAA,QAAkB,EAAA,QAClB,QAAA,OAAiB,EAAA,QACjB,QAAA,SAAmB,EAAA,QACnB,QAAA,QAAkB,EAAA,QAClB,QAAA,KAAe,EAAA,QACf,QAAA,MAAgB,EAAA,QAChB,QAAA,KAAe,EAAA;;ACiE5B,aAAA,SAAA,EAAA,EAAA,GAAA,KAAA,aAAA,GAAA,MAAA,IAAA,UAAA,qCAAA,SAAA,EAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,WAAA,EAAA,aAAA,EAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,UAAA,GAAA,OAAA,eAAA,EAAA,EAAA,IAAA,IAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,GAAA,EAAA,EAAA,UAAA,GAAA,GAAA,EAAA,EAAA,GAAA,EAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IArFA,IAAA,EAAA,QAAA,gCAEA,SAAS,EAAK,EAAW,GAChB,OAAA,EAAE,QAAU,EAAQ,EAAI,IAAI,MAAM,EAAQ,EAAE,OAAS,GAAG,KAAK,KAAO,EAG7E,SAAS,EAAa,GACd,IAAA,EAAc,EAAS,QAAQ,IAAK,IAEnC,OAAA,EADa,SAAS,EAAK,IAAI,SAAS,GAAG,SAAS,EAAG,KAC9C,IAAI,MAAM,IAAI,IAAI,SAAA,GAAO,MAAQ,MAAR,IAGrC,IAAA,EAyEN,WAnEe,SAAA,EAAA,GAAkE,IAAA,EAAgB,UAAA,OAAA,QAAA,IAAA,UAAA,GAAA,UAAA,GAAA,IAAG,EAAA,KAAA,GAL1F,KAAA,IAAc,IAEf,KAAA,UAA0E,GAC1E,KAAA,YAAsB,EAGtB,KAAA,UAAY,EAAU,IAAI,SAAA,GAAa,MAAA,CAC1C,QAAS,EAAS,QAClB,OAAQ,IAAI,MAAM,EAAS,cAExB,KAAA,IAAM,EA8Df,OAAA,EAAA,EAAA,CAAA,CAAA,IAAA,OA3De,MAAA,SAAA,GAA0B,IAAA,EAAA,KAChC,KAAA,YAAc,EACnB,cAAc,KAAK,UACd,KAAA,SAAW,YAAY,WAC1B,EAAS,EAAK,aACd,EAAK,QACH,IAAa,KAAK,OAqD1B,CAAA,IAAA,OAlDc,MAAA,WAAA,IAAA,EAAA,KACL,KAAA,UAAU,QAAQ,SAAA,GACF,EAAS,QAAQ,EAAK,eAGvC,EAAS,OAAO,QAChB,EAAS,OAAO,YAAc,EAC9B,EAAS,OAAO,UAIf,KAAA,aAAe,KAAK,YAAc,GAAK,KAAK,UAAU,GAAG,QAAQ,WAuC1E,EAAA,GAnCM,EAAY,CAChB,CAAE,MAAO,UAAW,OAAQ,EAAA,SAC5B,CAAE,MAAO,UAAW,OAAQ,EAAA,OAC5B,CAAE,MAAO,UAAW,OAAQ,EAAA,UAC5B,CAAE,MAAO,UAAW,OAAQ,EAAA,SAC5B,CAAE,MAAO,UAAW,OAAQ,EAAA,OAGxB,EAAM,IAAI,EAAU,EAAU,IAAI,SAAA,GAAM,MAAA,CAAE,QAAS,EAAY,EAAE,OAAQ,UAAW,EAAE,UAAY,KAElG,EAAS,SAAS,cAAc,UAChC,EAAM,EAAO,WAAW,MAExB,EAAc,GACd,EAAM,EAAc,iBAM1B,SAAS,EAAM,EAA8B,GAC3C,EAAI,UAAU,EAAG,EAAG,EAAO,MAAO,EAAO,QACzC,EAAkB,UAAU,QAAQ,SAAC,EAAU,GAC7C,EAAS,QAAQ,QAAQ,SAAC,EAAM,GAC9B,EAAI,UAAY,EAAO,EAAU,GAAG,MAAQ,UACtC,IAAA,EAAS,IAAM,EAAc,GAAK,EACxC,EAAI,SAAS,EAAI,EAAM,EAAQ,EAAI,EAAM,EAAQ,EAAM,EAAI,EAAQ,EAAM,EAAI,OAXnF,EAAO,MAAM,OAAS,EAAc,EAAI,UAAU,OAAS,KAC3D,EAAO,MAAM,OAAS,EAAc,EAAI,UAAU,GAAG,QAAQ,OAAS,KACtE,EAAO,OAAS,EAAM,EAAI,UAAU,OACpC,EAAO,MAAQ,EAAM,EAAI,UAAU,GAAG,QAAQ,OAa9C,EAAK,EAAK,GAEV,SAAS,KAAK,OAAO,GAErB,SAAS,cAAc,UAAU,iBAAiB,QAAS,WACzD,EAAI,KAAK,SAAA,GACP,EAAK,EAAK","file":"main.b5a871b1.js","sourceRoot":"..","sourcesContent":["import hiCongaSrc from './conga_hi.wav'\nimport lowCongaSrc from './conga_low.wav'\nimport midCongaSrc from './conga_mid.wav'\nimport cowbellSrc from './cowbell.wav'\nimport cymbalSrc from './cymbal.wav'\nimport closeHatSrc from './hat_close.wav'\nimport openHatSrc from './hat_open.wav'\nimport kickSrc from './kick.wav'\nimport snareSrc from './snare.wav'\nimport clapSrc from './clap.wav'\n\nexport const hiConga: string = hiCongaSrc\nexport const lowConga: string = lowCongaSrc\nexport const midConga: string = midCongaSrc\nexport const cowbell: string = cowbellSrc\nexport const cymbal: string = cymbalSrc\nexport const closeHat: string = closeHatSrc\nexport const openHat: string = openHatSrc\nexport const kick: string = kickSrc\nexport const snare: string = snareSrc\nexport const clap: string = clapSrc\n","import { closeHat, hiConga, cowbell, snare, kick } from './assets/samples/tr808/index'\n\nfunction pad (n: string, width: number): string {\n  return n.length >= width ? n : new Array(width - n.length + 1).join('0') + n\n}\n\nfunction color2rythm (colorHex: string): Array<boolean> {\n  const hex: string = colorHex.replace('#', '')\n  const bin: string = parseInt(hex, 16).toString(2).padStart(8, '0')\n  return pad(bin, 24).split('').map(val => val === '1')\n}\n\nclass Sequencer {\n  private bpm: number = 120\n  private interval: number\n  public sequences: Array<{ pattern: Array<boolean>, sample: HTMLAudioElement }> = []\n  public currentStep: number = 0\n\n  constructor (sequences: Array<{ pattern: Array<boolean>, sampleSrc: string }>, tempo: number = 120) {\n    this.sequences = sequences.map(sequence => ({\n      pattern: sequence.pattern,\n      sample: new Audio(sequence.sampleSrc)\n    }))\n    this.bpm = tempo\n  }\n\n  public play (callback: (number) => void): void {\n    this.currentStep = 0\n    clearInterval(this.interval)\n    this.interval = setInterval(() => {\n      callback(this.currentStep)\n      this.step()\n    }, (60 * 1000) / this.bpm)\n  }\n\n  private step (): void {\n    this.sequences.forEach(sequence => {\n      const shouldPlay = sequence.pattern[this.currentStep]\n\n      if (shouldPlay) {\n        sequence.sample.pause()\n        sequence.sample.currentTime = 0\n        sequence.sample.play()\n      }\n    })\n\n    this.currentStep = (this.currentStep + 1) % this.sequences[0].pattern.length\n  }\n}\n\nconst sequences = [\n  { color: '#4285F4', sample: cowbell },\n  { color: '#DB4437', sample: snare },\n  { color: '#F4B400', sample: closeHat },\n  { color: '#0F9D58', sample: hiConga },\n  { color: '#AAAAAA', sample: kick }\n]\n\nconst seq = new Sequencer(sequences.map(s => ({ pattern: color2rythm(s.color), sampleSrc: s.sample })), 120)\n\nconst canvas = document.createElement('canvas')\nconst ctx = canvas.getContext('2d')\n\nconst physicalScl = 30\nconst scl = physicalScl * devicePixelRatio\ncanvas.style.height = physicalScl * seq.sequences.length + 'px'\ncanvas.style.widows = physicalScl * seq.sequences[0].pattern.length + 'px'\ncanvas.height = scl * seq.sequences.length\ncanvas.width = scl * seq.sequences[0].pattern.length\n\nfunction draw (sequencerInstance: Sequencer, currentStep: number): void {\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\n  sequencerInstance.sequences.forEach((sequence, y) => {\n    sequence.pattern.forEach((step, x) => {\n      ctx.fillStyle = step ? sequences[y].color : '#eceff1'\n      const margin = x === currentStep ? 10 : 2\n      ctx.fillRect(x * scl + margin, y * scl + margin, scl - 2 * margin, scl - 2 * margin)\n    })\n  })\n}\n\ndraw(seq, 0)\n\ndocument.body.append(canvas)\n\ndocument.querySelector('button').addEventListener('click', () => {\n  seq.play(currentStep => {\n    draw(seq, currentStep)\n  })\n})\n"]}